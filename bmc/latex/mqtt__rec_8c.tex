\doxysection{ha\+\_\+energy/mqtt\+\_\+rec.c File Reference}
\hypertarget{mqtt__rec_8c}{}\label{mqtt__rec_8c}\index{ha\_energy/mqtt\_rec.c@{ha\_energy/mqtt\_rec.c}}
{\ttfamily \#include "{}bsoc.\+h"{}}\newline
Include dependency graph for mqtt\+\_\+rec.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{mqtt__rec_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int32\+\_\+t \mbox{\hyperlink{mqtt__rec_8c_aeb7f1edb73f2b51c6df601678ca4df22}{msgarrvd}} (void \texorpdfstring{$\ast$}{*}context, char \texorpdfstring{$\ast$}{*}topic\+Name, int topic\+Len, MQTTClient\+\_\+message \texorpdfstring{$\ast$}{*}message)
\item 
void \mbox{\hyperlink{mqtt__rec_8c_a4a79780b9057489f0740020d6bae250f}{delivered}} (void \texorpdfstring{$\ast$}{*}context, MQTTClient\+\_\+delivery\+Token dt)
\item 
bool \mbox{\hyperlink{mqtt__rec_8c_acaa1a0e82c0b21e28a7b6fd6c1d6ac43}{json\+\_\+get\+\_\+data}} (c\+JSON \texorpdfstring{$\ast$}{*}json\+\_\+src, const char \texorpdfstring{$\ast$}{*}data\+\_\+id, c\+JSON \texorpdfstring{$\ast$}{*}name, uint32\+\_\+t i)
\item 
void \mbox{\hyperlink{mqtt__rec_8c_a7ce8be1d4c8d4c9881d482bed4933512}{print\+\_\+mvar\+\_\+vars}} (void)
\item 
bool \mbox{\hyperlink{mqtt__rec_8c_ab3219c1d482ea970a00a713bc9631eb6}{fm80\+\_\+float}} (const bool set\+\_\+bias)
\item 
bool \mbox{\hyperlink{mqtt__rec_8c_a218d78ec87cc0f9067283f98bace529f}{fm80\+\_\+sleep}} (void)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
data received on topic from the broker, run processing thread max message length set by MBMQTT 

Definition in file \mbox{\hyperlink{mqtt__rec_8c_source}{mqtt\+\_\+rec.\+c}}.



\label{doc-func-members}
\Hypertarget{mqtt__rec_8c_doc-func-members}
\doxysubsection{Function Documentation}
\Hypertarget{mqtt__rec_8c_a4a79780b9057489f0740020d6bae250f}\index{mqtt\_rec.c@{mqtt\_rec.c}!delivered@{delivered}}
\index{delivered@{delivered}!mqtt\_rec.c@{mqtt\_rec.c}}
\doxysubsubsection{\texorpdfstring{delivered()}{delivered()}}
{\footnotesize\ttfamily \label{mqtt__rec_8c_a4a79780b9057489f0740020d6bae250f} 
void delivered (\begin{DoxyParamCaption}\item[{void \texorpdfstring{$\ast$}{*}}]{context}{, }\item[{MQTTClient\+\_\+delivery\+Token}]{dt}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{mqtt__rec_8c_source_l00122}{122}} of file \mbox{\hyperlink{mqtt__rec_8c_source}{mqtt\+\_\+rec.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00123\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structha__flag__type}{ha\_flag\_type}}\ *ha\_flag\ =\ context;}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{comment}{//\ bug-\/out\ if\ no\ context\ variables\ passed\ to\ callback}}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordflow}{if}\ (context\ ==\ NULL)\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00129\ \ \ \ \ \}}
\DoxyCodeLine{00130\ \ \ \ \ ha\_flag-\/>deliveredtoken\ =\ dt;}
\DoxyCodeLine{00131\ \}}

\end{DoxyCode}
\Hypertarget{mqtt__rec_8c_ab3219c1d482ea970a00a713bc9631eb6}\index{mqtt\_rec.c@{mqtt\_rec.c}!fm80\_float@{fm80\_float}}
\index{fm80\_float@{fm80\_float}!mqtt\_rec.c@{mqtt\_rec.c}}
\doxysubsubsection{\texorpdfstring{fm80\_float()}{fm80\_float()}}
{\footnotesize\ttfamily \label{mqtt__rec_8c_ab3219c1d482ea970a00a713bc9631eb6} 
bool fm80\+\_\+float (\begin{DoxyParamCaption}\item[{const bool}]{set\+\_\+bias}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{mqtt__rec_8c_source_l00246}{246}} of file \mbox{\hyperlink{mqtt__rec_8c_source}{mqtt\+\_\+rec.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00247\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{keywordflow}{if}\ ((uint32\_t)\ E.mvar[V\_FCCM]\ ==\ FLOAT\_CODE)\ \{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (set\_bias)\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.pv\_bias\ =\ PV\_BIAS\_FLOAT;}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (E.mode.R\ !=\ R\_IDLE)\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.R\ =\ R\_FLOAT;}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00256\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (E.mode.R\ ==\ R\_FLOAT)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.R\ =\ R\_RUN;}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00260\ \ \ \ \ \}}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00262\ \}}

\end{DoxyCode}
\Hypertarget{mqtt__rec_8c_a218d78ec87cc0f9067283f98bace529f}\index{mqtt\_rec.c@{mqtt\_rec.c}!fm80\_sleep@{fm80\_sleep}}
\index{fm80\_sleep@{fm80\_sleep}!mqtt\_rec.c@{mqtt\_rec.c}}
\doxysubsubsection{\texorpdfstring{fm80\_sleep()}{fm80\_sleep()}}
{\footnotesize\ttfamily \label{mqtt__rec_8c_a218d78ec87cc0f9067283f98bace529f} 
bool fm80\+\_\+sleep (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{mqtt__rec_8c_source_l00268}{268}} of file \mbox{\hyperlink{mqtt__rec_8c_source}{mqtt\+\_\+rec.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00269\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{keywordflow}{if}\ ((uint32\_t)\ E.mvar[V\_FCCM]\ ==\ SLEEP\_CODE)\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00272\ \ \ \ \ \}}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00274\ \}}

\end{DoxyCode}
\Hypertarget{mqtt__rec_8c_acaa1a0e82c0b21e28a7b6fd6c1d6ac43}\index{mqtt\_rec.c@{mqtt\_rec.c}!json\_get\_data@{json\_get\_data}}
\index{json\_get\_data@{json\_get\_data}!mqtt\_rec.c@{mqtt\_rec.c}}
\doxysubsubsection{\texorpdfstring{json\_get\_data()}{json\_get\_data()}}
{\footnotesize\ttfamily \label{mqtt__rec_8c_acaa1a0e82c0b21e28a7b6fd6c1d6ac43} 
bool json\+\_\+get\+\_\+data (\begin{DoxyParamCaption}\item[{c\+JSON \texorpdfstring{$\ast$}{*}}]{json\+\_\+src}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{data\+\_\+id}{, }\item[{c\+JSON \texorpdfstring{$\ast$}{*}}]{name}{, }\item[{uint32\+\_\+t}]{i}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{mqtt__rec_8c_source_l00137}{137}} of file \mbox{\hyperlink{mqtt__rec_8c_source}{mqtt\+\_\+rec.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00138\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{bool}\ ret\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{static}\ uint32\_t\ j\ =\ 0;}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ access\ the\ JSON\ data\ using\ the\ lookup\ string\ passed\ in\ data\_id}}
\DoxyCodeLine{00143\ \ \ \ \ name\ =\ cJSON\_GetObjectItemCaseSensitive(json\_src,\ data\_id);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00146\ \textcolor{comment}{\ \ \ \ \ *\ process\ string\ values}}
\DoxyCodeLine{00147\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordflow}{if}\ (cJSON\_IsString(name)\ \&\&\ (name-\/>valuestring\ !=\ NULL))\ \{}
\DoxyCodeLine{00149\ \textcolor{preprocessor}{\#ifdef\ GET\_DEBUG}}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ fprintf(fout,\ \textcolor{stringliteral}{"{}\%s\ Name:\ \%s\(\backslash\)n"{}},\ data\_id,\ name-\/>valuestring);}
\DoxyCodeLine{00151\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ ret\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00153\ \ \ \ \ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00156\ \textcolor{comment}{\ \ \ \ \ *\ process\ numeric\ values}}
\DoxyCodeLine{00157\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keywordflow}{if}\ (cJSON\_IsNumber(name))\ \{}
\DoxyCodeLine{00159\ \textcolor{preprocessor}{\#ifdef\ GET\_DEBUG}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ fprintf(fout,\ \textcolor{stringliteral}{"{}\%s\ Value:\ \%f\(\backslash\)n"{}},\ data\_id,\ name-\/>valuedouble);}
\DoxyCodeLine{00161\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ >\ V\_DLAST)\ \{\ \textcolor{comment}{//\ check\ for\ out-\/of-\/range\ index}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ i\ =\ V\_DLAST;}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ lock\ the\ main\ value\ array\ during\ updates}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ pthread\_mutex\_lock(\&E.ha\_lock);}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ E.mvar[i]\ =\ name-\/>valuedouble;}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ pthread\_mutex\_unlock(\&E.ha\_lock);}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00172\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ special\ processing\ for\ variable\ data\ received}}
\DoxyCodeLine{00173\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_DCMPPT)\ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00176\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ load\ battery\ current\ standard\ deviation\ array\ bat\_c\_std\_dev\ with\ data}}
\DoxyCodeLine{00177\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ bsoc\_set\_std\_dev(E.mvar[i],\ j++);}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (j\ >=\ RDEV\_SIZE)\ \{}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ j\ =\ 0;}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00184\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ update\ local\ MATTER\ switch\ status\ from\ HA}}
\DoxyCodeLine{00185\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HDCSW)\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ E.gti\_sw\_status\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ E.dc\_mismatch\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HACSW)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ E.ac\_sw\_status\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ E.ac\_mismatch\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ command\ HA\_ENERGY\ to\ shutdown\ mode}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HSHUT)\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ E.solar\_shutdown\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ HA\_ENERGY\ energy\ processing\ mode}}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HMODE)\ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ ha\_flag\_vars\_ss.energy\_mode\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HCON0)\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.con0\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HCON1)\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.con1\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HCON2)\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.con2\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HCON3)\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.con3\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HCON4)\ \{\ \textcolor{comment}{//\ set\ DL\ GTI\ excess\ load\ MODE}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.con4\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HCON5)\ \{\ \textcolor{comment}{//\ clear\ DL\ GTI\ excess\ load\ MODE}}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.con5\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HCON6)\ \{\ \textcolor{comment}{//\ HA\ Energy\ program\ idle}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.con6\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ V\_HCON7)\ \{\ \textcolor{comment}{//\ HA\ Energy\ program\ exit}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ E.mode.con7\ =\ (bool)\ ((int32\_t)\ E.mvar[i]);}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ ret\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00229\ \ \ \ \ \}}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{00231\ \}}

\end{DoxyCode}
\Hypertarget{mqtt__rec_8c_aeb7f1edb73f2b51c6df601678ca4df22}\index{mqtt\_rec.c@{mqtt\_rec.c}!msgarrvd@{msgarrvd}}
\index{msgarrvd@{msgarrvd}!mqtt\_rec.c@{mqtt\_rec.c}}
\doxysubsubsection{\texorpdfstring{msgarrvd()}{msgarrvd()}}
{\footnotesize\ttfamily \label{mqtt__rec_8c_aeb7f1edb73f2b51c6df601678ca4df22} 
int32\+\_\+t msgarrvd (\begin{DoxyParamCaption}\item[{void \texorpdfstring{$\ast$}{*}}]{context}{, }\item[{char \texorpdfstring{$\ast$}{*}}]{topic\+Name}{, }\item[{int}]{topic\+Len}{, }\item[{MQTTClient\+\_\+message \texorpdfstring{$\ast$}{*}}]{message}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{mqtt__rec_8c_source_l00007}{7}} of file \mbox{\hyperlink{mqtt__rec_8c_source}{mqtt\+\_\+rec.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00008\ \{}
\DoxyCodeLine{00009\ \ \ \ \ int32\_t\ i,\ ret\ =\ 1;}
\DoxyCodeLine{00010\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ payloadptr;}
\DoxyCodeLine{00011\ \ \ \ \ \textcolor{keywordtype}{char}\ buffer[MBMQTT];}
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structha__flag__type}{ha\_flag\_type}}\ *ha\_flag\ =\ context;}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \ \ \ \ E.link.mqtt\_count++;}
\DoxyCodeLine{00015\ \ \ \ \ \textcolor{comment}{//\ bug-\/out\ if\ no\ context\ variables\ passed\ to\ callback}}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{keywordflow}{if}\ (context\ ==\ NULL)\ \{}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ ret\ =\ -\/1;}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ null\_exit;}
\DoxyCodeLine{00019\ \ \ \ \ \}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#ifdef\ DEBUG\_REC}}
\DoxyCodeLine{00022\ \ \ \ \ fprintf(fout,\ \textcolor{stringliteral}{"{}Message\ arrived\(\backslash\)n"{}});}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ \ \ \ \ *\ move\ the\ received\ message\ into\ a\ processing\ holding\ buffer}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00027\ \ \ \ \ payloadptr\ =\ message-\/>payload;}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ message-\/>payloadlen;\ i++)\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ buffer[i]\ =\ *payloadptr++;}
\DoxyCodeLine{00030\ \ \ \ \ \}}
\DoxyCodeLine{00031\ \ \ \ \ buffer[i]\ =\ 0;\ \textcolor{comment}{//\ make\ a\ null\ terminated\ C\ string}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{comment}{//\ parse\ the\ JSON\ data\ in\ the\ holding\ buffer}}
\DoxyCodeLine{00034\ \ \ \ \ cJSON\ *json\ =\ cJSON\_ParseWithLength(buffer,\ message-\/>payloadlen);}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keywordflow}{if}\ (json\ ==\ NULL)\ \{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *error\_ptr\ =\ cJSON\_GetErrorPtr();}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (error\_ptr\ !=\ NULL)\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ fprintf(fout,\ \textcolor{stringliteral}{"{}\%s\ Error:\ \%s\ NULL\ cJSON\ pointer\(\backslash\)n"{}},\ log\_time(\textcolor{keyword}{false}),\ error\_ptr);}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ ret\ =\ -\/1;}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ ha\_flag-\/>rec\_ok\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ E.fm80\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ E.dumpload\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ E.homeassistant\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ E.link.mqtt\_error++;}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ error\_exit;}
\DoxyCodeLine{00047\ \ \ \ \ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00050\ \textcolor{comment}{\ \ \ \ \ *\ MQTT\ messages\ from\ the\ FM80\ Q84\ interface}}
\DoxyCodeLine{00051\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{if}\ (ha\_flag-\/>ha\_id\ ==\ FM80\_ID)\ \{}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#ifdef\ DEBUG\_REC}}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ fprintf(fout,\ \textcolor{stringliteral}{"{}FM80\ MQTT\ data\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ cJSON\ *data\_result\ =\ json;}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ ii\ =\ V\_FCCM;\ ii\ <\ V\_FLAST;\ ii++)\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (json\_get\_data(json,\ mqtt\_name[ii],\ data\_result,\ ii))\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ha\_flag-\/>var\_update++;}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ E.fm80\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00064\ \ \ \ \ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00067\ \textcolor{comment}{\ \ \ \ \ *\ MQTT\ messages\ from\ the\ K42\ dumpload/gti\ interface}}
\DoxyCodeLine{00068\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordflow}{if}\ (ha\_flag-\/>ha\_id\ ==\ DUMPLOAD\_ID)\ \{}
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#ifdef\ DEBUG\_REC}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ fprintf(fout,\ \textcolor{stringliteral}{"{}DUMPLOAD\ MQTT\ data\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{00072\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ cJSON\ *data\_result\ =\ json;}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ ii\ =\ V\_HDCSW;\ ii\ <\ V\_DLAST;\ ii++)\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (json\_get\_data(json,\ mqtt\_name[ii],\ data\_result,\ ii))\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ha\_flag-\/>var\_update++;}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ E.dumpload\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00084\ \textcolor{comment}{\ \ \ \ \ *\ MQTT\ messages\ from\ the\ Linux\ HA\_ENERGY\ interface}}
\DoxyCodeLine{00085\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordflow}{if}\ (ha\_flag-\/>ha\_id\ ==\ HA\_ID)\ \{}
\DoxyCodeLine{00087\ \textcolor{preprocessor}{\#ifdef\ DEBUG\_REC}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ fprintf(fout,\ \textcolor{stringliteral}{"{}Home\ Assistant\ MQTT\ data\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{00089\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ cJSON\ *data\_result\ =\ json;}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (json\_get\_data(json,\ mqtt\_name[V\_HACSW],\ data\_result,\ V\_HACSW))\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ ha\_flag-\/>var\_update++;}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ data\_result\ =\ json;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (json\_get\_data(json,\ mqtt\_name[V\_HDCSW],\ data\_result,\ V\_HDCSW))\ \{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ ha\_flag-\/>var\_update++;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ E.homeassistant\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00101\ \ \ \ \ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ done\ with\ processing\ MQTT\ async\ message,\ set\ state\ flags}}
\DoxyCodeLine{00104\ \ \ \ \ ha\_flag-\/>receivedtoken\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00105\ \ \ \ \ ha\_flag-\/>rec\_ok\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00107\ \textcolor{comment}{\ \ \ \ \ *\ exit\ and\ delete/free\ resources.\ In\ steps\ depending\ of\ possible\ error\ conditions}}
\DoxyCodeLine{00108\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00109\ error\_exit:}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ delete\ the\ JSON\ object}}
\DoxyCodeLine{00111\ \ \ \ \ cJSON\_Delete(json);}
\DoxyCodeLine{00112\ null\_exit:}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{comment}{//\ free\ the\ MQTT\ objects}}
\DoxyCodeLine{00114\ \ \ \ \ MQTTClient\_freeMessage(\&message);}
\DoxyCodeLine{00115\ \ \ \ \ MQTTClient\_free(topicName);}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{00117\ \}}

\end{DoxyCode}
\Hypertarget{mqtt__rec_8c_a7ce8be1d4c8d4c9881d482bed4933512}\index{mqtt\_rec.c@{mqtt\_rec.c}!print\_mvar\_vars@{print\_mvar\_vars}}
\index{print\_mvar\_vars@{print\_mvar\_vars}!mqtt\_rec.c@{mqtt\_rec.c}}
\doxysubsubsection{\texorpdfstring{print\_mvar\_vars()}{print\_mvar\_vars()}}
{\footnotesize\ttfamily \label{mqtt__rec_8c_a7ce8be1d4c8d4c9881d482bed4933512} 
void print\+\_\+mvar\+\_\+vars (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{mqtt__rec_8c_source_l00236}{236}} of file \mbox{\hyperlink{mqtt__rec_8c_source}{mqtt\+\_\+rec.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00237\ \{}
\DoxyCodeLine{00238\ \ \ \ \ fprintf(fout,\ \textcolor{stringliteral}{"{},\ AC\ Inverter\ \%7.2fW,\ BAT\ Energy\ \%7.2fWh,\ Solar\ E\ \%7.2fWh,\ AC\ E\ \%7.2fWh,\ PERR\ \%7.2fW,\ PBAL\ \%7.2fW,\ ST\ \%7.2f,\ GDL\ \%7.2f,\ \%d,\%d,\%d\ \%d,\%d,\%d\(\backslash\)r"{}},}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ E.mvar[V\_FLO],\ E.mvar[V\_FBEKW],\ E.mvar[V\_FSO],\ E.mvar[V\_FACE],\ E.mode.error,\ E.mvar[V\_BEN],\ E.mode.total\_system,\ E.mode.gti\_dumpload,\ (int32\_t)\ E.mvar[V\_HDCSW],\ (int32\_t)\ E.mvar[V\_HACSW],\ (int32\_t)\ E.mvar[V\_HMODE],}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ (int32\_t)\ E.dc\_mismatch,\ (int32\_t)\ E.ac\_mismatch,\ (int32\_t)\ E.mode\_mismatch);}
\DoxyCodeLine{00241\ \}}

\end{DoxyCode}
