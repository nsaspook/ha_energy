\doxysection{ha\+\_\+energy/bsoc.c File Reference}
\hypertarget{bsoc_8c}{}\label{bsoc_8c}\index{ha\_energy/bsoc.c@{ha\_energy/bsoc.c}}
{\ttfamily \#include "{}bsoc.\+h"{}}\newline
Include dependency graph for bsoc.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structlocal__type}{local\+\_\+type}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static double \mbox{\hyperlink{bsoc_8c_aa9b00e4f08c59d45a2baa05cc44191a2}{error\+\_\+filter}} (const double)
\item 
bool \mbox{\hyperlink{bsoc_8c_a571a7c60ba1a2a6c569427c21c829733}{bsoc\+\_\+init}} (void)
\item 
void \mbox{\hyperlink{bsoc_8c_adc8522b4d922a9ce45f83ca6a8d2708c}{bsoc\+\_\+set\+\_\+std\+\_\+dev}} (const double value, const uint32\+\_\+t i)
\item 
bool \mbox{\hyperlink{bsoc_8c_a4c8b6884b4cae5d49a0d4141ce516372}{bsoc\+\_\+data\+\_\+collect}} (void)
\item 
double \mbox{\hyperlink{bsoc_8c_a63f8e1b6516cda51fd09570aaf4e147d}{bsoc\+\_\+ac}} (void)
\item 
double \mbox{\hyperlink{bsoc_8c_ab9a97f08a9166d16e45b2025c3887eab}{bsoc\+\_\+gti}} (void)
\item 
double \mbox{\hyperlink{bsoc_8c_ade03000a21b56a5527367c81e7219c99}{gti\+\_\+test}} (void)
\item 
double \mbox{\hyperlink{bsoc_8c_a413c5066cb43aae0039adba36593129a}{ac\+\_\+test}} (void)
\item 
double \mbox{\hyperlink{bsoc_8c_a8f6e0fd4594d467a89005d81038aa602}{get\+\_\+batc\+\_\+dev}} (void)
\item 
double \mbox{\hyperlink{bsoc_8c_a822d408a5e379216cd6a003381f94b43}{calculate\+Standard\+Deviation}} (const uint32\+\_\+t N, const double data\mbox{[}$\,$\mbox{]})
\item 
bool \mbox{\hyperlink{bsoc_8c_a4ff1d7778a0780a0f1c029a738322513}{bat\+\_\+current\+\_\+stable}} (void)
\item 
bool \mbox{\hyperlink{bsoc_8c_a49c1e06b8059a63a9ed7c7d729e59d90}{bsoc\+\_\+set\+\_\+mode}} (const double target, const bool mode, const bool init)
\item 
double \mbox{\hyperlink{bsoc_8c_af738b354e21276b35d56a42f217ac1f8}{ac0\+\_\+filter}} (const double raw)
\item 
double \mbox{\hyperlink{bsoc_8c_a4ec0fe226796da34c999530046265c3a}{ac1\+\_\+filter}} (const double raw)
\item 
double \mbox{\hyperlink{bsoc_8c_aa933af2d3df8ce390f6f95900df4b525}{ac2\+\_\+filter}} (const double raw)
\item 
double \mbox{\hyperlink{bsoc_8c_a017e138f3c81b9dd94af5d7e7bd7616c}{dc0\+\_\+filter}} (const double raw)
\item 
double \mbox{\hyperlink{bsoc_8c_a623a5ccd411eeeba8acd1132a33a15e8}{dc1\+\_\+filter}} (const double raw)
\item 
double \mbox{\hyperlink{bsoc_8c_a4846561257bfbb8d753328d1fe7a1c07}{dc2\+\_\+filter}} (const double raw)
\item 
double \mbox{\hyperlink{bsoc_8c_a9ceac393328d0a6c09cccc8c38fa30a1}{drive0\+\_\+filter}} (const double raw)
\item 
double \mbox{\hyperlink{bsoc_8c_a9cf492c9b858a53133af1b29b9f68708}{drive1\+\_\+filter}} (const double raw)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const char \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{bsoc_8c_ae6b57480d8cda466cfc65b9bfc47b255}{mqtt\+\_\+name}} \mbox{[}\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072ab183b38bd716ecf9405c4546e3bd6870}{V\+\_\+\+DLAST}}\mbox{]}
\item 
static struct \mbox{\hyperlink{structlocal__type}{local\+\_\+type}} \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\Hypertarget{bsoc_8c_af738b354e21276b35d56a42f217ac1f8}\index{bsoc.c@{bsoc.c}!ac0\_filter@{ac0\_filter}}
\index{ac0\_filter@{ac0\_filter}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{ac0\_filter()}{ac0\_filter()}}
{\footnotesize\ttfamily \label{bsoc_8c_af738b354e21276b35d56a42f217ac1f8} 
double ac0\+\_\+filter (\begin{DoxyParamCaption}\item[{const double}]{raw}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00376\ \{}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ accum\ =\ 0.0f;}
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ coef\ =\ \mbox{\hyperlink{bsoc_8h_aeeb125aaf18ebb1dfcd400ac4c9cfb75}{COEFF}};}
\DoxyCodeLine{00379\ \ \ \ \ accum\ =\ accum\ -\/\ accum\ /\ coef\ +\ raw;}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{keywordflow}{return}\ accum\ /\ coef;}
\DoxyCodeLine{00381\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=311pt]{bsoc_8c_af738b354e21276b35d56a42f217ac1f8_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a4ec0fe226796da34c999530046265c3a}\index{bsoc.c@{bsoc.c}!ac1\_filter@{ac1\_filter}}
\index{ac1\_filter@{ac1\_filter}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{ac1\_filter()}{ac1\_filter()}}
{\footnotesize\ttfamily \label{bsoc_8c_a4ec0fe226796da34c999530046265c3a} 
double ac1\+\_\+filter (\begin{DoxyParamCaption}\item[{const double}]{raw}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00384\ \{}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ accum\ =\ 0.0f;}
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ coef\ =\ \mbox{\hyperlink{bsoc_8h_aadf817f59fb13a1a5c66ea9f7574b842}{COEF}};}
\DoxyCodeLine{00387\ \ \ \ \ accum\ =\ accum\ -\/\ accum\ /\ coef\ +\ raw;}
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{keywordflow}{return}\ accum\ /\ coef;}
\DoxyCodeLine{00389\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=219pt]{bsoc_8c_a4ec0fe226796da34c999530046265c3a_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_aa933af2d3df8ce390f6f95900df4b525}\index{bsoc.c@{bsoc.c}!ac2\_filter@{ac2\_filter}}
\index{ac2\_filter@{ac2\_filter}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{ac2\_filter()}{ac2\_filter()}}
{\footnotesize\ttfamily \label{bsoc_8c_aa933af2d3df8ce390f6f95900df4b525} 
double ac2\+\_\+filter (\begin{DoxyParamCaption}\item[{const double}]{raw}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00392\ \{}
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ accum\ =\ 0.0f;}
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ coef\ =\ \mbox{\hyperlink{bsoc_8h_aadf817f59fb13a1a5c66ea9f7574b842}{COEF}};}
\DoxyCodeLine{00395\ \ \ \ \ accum\ =\ accum\ -\/\ accum\ /\ coef\ +\ raw;}
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{keywordflow}{return}\ accum\ /\ coef;}
\DoxyCodeLine{00397\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=219pt]{bsoc_8c_aa933af2d3df8ce390f6f95900df4b525_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a413c5066cb43aae0039adba36593129a}\index{bsoc.c@{bsoc.c}!ac\_test@{ac\_test}}
\index{ac\_test@{ac\_test}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{ac\_test()}{ac\_test()}}
{\footnotesize\ttfamily \label{bsoc_8c_a413c5066cb43aae0039adba36593129a} 
double ac\+\_\+test (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00191\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bsoc_8c_af738b354e21276b35d56a42f217ac1f8}{ac0\_filter}}(\mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.ac\_weight);}
\DoxyCodeLine{00193\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=230pt]{bsoc_8c_a413c5066cb43aae0039adba36593129a_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=209pt]{bsoc_8c_a413c5066cb43aae0039adba36593129a_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a4ff1d7778a0780a0f1c029a738322513}\index{bsoc.c@{bsoc.c}!bat\_current\_stable@{bat\_current\_stable}}
\index{bat\_current\_stable@{bat\_current\_stable}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{bat\_current\_stable()}{bat\_current\_stable()}}
{\footnotesize\ttfamily \label{bsoc_8c_a4ff1d7778a0780a0f1c029a738322513} 
bool bat\+\_\+current\+\_\+stable (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00240\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ gap\ =\ 0.0f;}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.batc\_std\_dev\ <=\ (\mbox{\hyperlink{bsoc_8h_ada660e6323c9300e8edf92b6406ee039}{MAX\_BATC\_DEV}}\ +\ gap))\ \{}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ gap\ =\ \mbox{\hyperlink{bsoc_8h_ada660e6323c9300e8edf92b6406ee039}{MAX\_BATC\_DEV}};}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.bat\_c\_std\_dev[0]\ <\ \mbox{\hyperlink{bsoc_8h_abb20d4d6de786054de4ac85d7314d51d}{BAT\_C\_DRAW}})\ \{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ gap\ =\ 0.0f;}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00251\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ gap\ =\ 0.0f;}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00254\ \ \ \ \ \}}
\DoxyCodeLine{00255\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c_a4ff1d7778a0780a0f1c029a738322513_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a63f8e1b6516cda51fd09570aaf4e147d}\index{bsoc.c@{bsoc.c}!bsoc\_ac@{bsoc\_ac}}
\index{bsoc\_ac@{bsoc\_ac}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{bsoc\_ac()}{bsoc\_ac()}}
{\footnotesize\ttfamily \label{bsoc_8c_a63f8e1b6516cda51fd09570aaf4e147d} 
double bsoc\+\_\+ac (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00136\ \{}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bsoc_8c_af738b354e21276b35d56a42f217ac1f8}{ac0\_filter}}(\mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.ac\_weight);}
\DoxyCodeLine{00139\ \};}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=234pt]{bsoc_8c_a63f8e1b6516cda51fd09570aaf4e147d_cgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a4c8b6884b4cae5d49a0d4141ce516372}\index{bsoc.c@{bsoc.c}!bsoc\_data\_collect@{bsoc\_data\_collect}}
\index{bsoc\_data\_collect@{bsoc\_data\_collect}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{bsoc\_data\_collect()}{bsoc\_data\_collect()}}
{\footnotesize\ttfamily \label{bsoc_8c_a4c8b6884b4cae5d49a0d4141ce516372} 
bool bsoc\+\_\+data\+\_\+collect (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00086\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{bool}\ ret\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keyword}{static}\ uint32\_t\ i\ =\ 0;}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ lockout\ threaded\ updates}}
\DoxyCodeLine{00090\ \ \ \ \ pthread\_mutex\_lock(\&\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.ha\_lock);\ \textcolor{comment}{//\ lockout\ MQTT\ var\ updates}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.ac\_weight\ =\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a821ba4dacc502ba41ec0c17aff5c42d3}{V\_FBEKW}}];}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.gti\_weight\ =\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a821ba4dacc502ba41ec0c17aff5c42d3}{V\_FBEKW}}];}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\#ifdef\ FAKE\_VPV\ }\textcolor{comment}{//\ no\ DUMPLOAD\ AC\ charger}}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.gti\_sw\_on)\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ pv\_voltage\ =\ \mbox{\hyperlink{bsoc_8h_a2bae68642a6208f91a301a9b479f51b9}{PV\_V\_NOM}};}
\DoxyCodeLine{00097\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ pv\_voltage\ =\ \mbox{\hyperlink{bsoc_8h_a95c668de635eec6ef69588d3fea0ff87}{PV\_V\_FAKE}};}
\DoxyCodeLine{00099\ \ \ \ \ \}}
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072aea100527e1fc47fec8e53ea94b738b75}{V\_DVPV}}]\ =\ pv\_voltage;}
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00102\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.pv\_voltage\ =\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072aea100527e1fc47fec8e53ea94b738b75}{V\_DVPV}}];}
\DoxyCodeLine{00103\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00104\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.bat\_voltage\ =\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a313329bdfc449d61aa60f11b31432e1f}{V\_DVBAT}}];}
\DoxyCodeLine{00105\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.bat\_current\ =\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a2dd8cb6e7c42be6b299e5d3d6617d7c2}{V\_DCMPPT}}];}
\DoxyCodeLine{00106\ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.ac\_low\_adj\ =\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072aea8f7852e1fb2fb07ea23c17aaed223e}{V\_FSO}}]*\ -\/0.5f;}
\DoxyCodeLine{00107\ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.gti\_low\_adj\ =\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072af52d8a89895cb70ab99159fcad262585}{V\_FACE}}]\ *\ -\/0.5f;}
\DoxyCodeLine{00108\ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.dl\_mqtt\_max\ =\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a966e201afd63441eacdb3f18b7dcd592}{V\_DPMPPT}}];}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ pthread\_mutex\_unlock(\&\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.ha\_lock);\ \textcolor{comment}{//\ resume\ remote\ MQTT\ var\ updates}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.ac\_low\_adj\ <\ -\/2000.0f)\ \{}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.ac\_low\_adj\ =\ -\/2000.0f;}
\DoxyCodeLine{00114\ \ \ \ \ \}}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.gti\_low\_adj\ <\ -\/2000.0f)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.gti\_low\_adj\ =\ -\/2000.0f;}
\DoxyCodeLine{00117\ \ \ \ \ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.bat\_c\_std\_dev[i++]\ =\ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.bat\_current;}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ >=\ \mbox{\hyperlink{bsoc_8h_a8a3855a66a1f87247cedfa3cc72d20c0}{DEV\_SIZE}})\ \{}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ i\ =\ 0;}
\DoxyCodeLine{00122\ \ \ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_a822d408a5e379216cd6a003381f94b43}{calculateStandardDeviation}}(\mbox{\hyperlink{bsoc_8h_a8a3855a66a1f87247cedfa3cc72d20c0}{DEV\_SIZE}},\ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.bat\_c\_std\_dev);}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \textcolor{preprocessor}{\#ifdef\ BSOC\_DEBUG}}
\DoxyCodeLine{00127\ \ \ \ \ fprintf(\mbox{\hyperlink{energy_8c_acec19516a59050bb447192fe318e6a9c}{fout}},\ \textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)nmqtt\ var\ bsoc\ update\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{00128\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{00130\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c_a4c8b6884b4cae5d49a0d4141ce516372_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=261pt]{bsoc_8c_a4c8b6884b4cae5d49a0d4141ce516372_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_ab9a97f08a9166d16e45b2025c3887eab}\index{bsoc.c@{bsoc.c}!bsoc\_gti@{bsoc\_gti}}
\index{bsoc\_gti@{bsoc\_gti}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{bsoc\_gti()}{bsoc\_gti()}}
{\footnotesize\ttfamily \label{bsoc_8c_ab9a97f08a9166d16e45b2025c3887eab} 
double bsoc\+\_\+gti (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00146\ \{}
\DoxyCodeLine{00147\ \textcolor{preprocessor}{\#ifdef\ BSOC\_DEBUG}}
\DoxyCodeLine{00148\ \ \ \ \ fprintf(\mbox{\hyperlink{energy_8c_acec19516a59050bb447192fe318e6a9c}{fout}},\ \textcolor{stringliteral}{"{}pvp\ \%f,\ gweight\ \%f,\ aweight\ \%f,\ batv\ \%f,\ batc\ \%f\(\backslash\)r\(\backslash\)n"{}},\ pv\_voltage,\ gti\_weight,\ ac\_weight,\ bat\_voltage,\ bat\_current);}
\DoxyCodeLine{00149\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//\ check\ for\ 48VDC\ AC\ charger\ powered\ from\ the\ Solar\ battery\ bank\ AC\ inverter\ unless\ E.dl\_excess\ is\ TRUE}}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{if}\ (((\mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.pv\_voltage\ <\ \mbox{\hyperlink{bsoc_8h_ac72ac391d051ffd4e1d466d6ede48b34}{MIN\_PV\_VOLTS}})\ \&\&\ (!\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.dl\_excess))\ ||\ (\mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.bat\_voltage\ <\ \mbox{\hyperlink{bsoc_8h_ade1038e9edec3b8646f4288f3b32b713}{MIN\_BAT\_VOLTS}}))\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.gti\_weight\ =\ 0.0f;\ \textcolor{comment}{//\ reduce\ power\ to\ zero}}
\DoxyCodeLine{00153\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.dl\_excess)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a79eef89bbb62af24bc79c04f29d0ad97}{V\_DAHBAT}}]\ >\ \mbox{\hyperlink{energy_8h_a69ba8a83d257f96478010c24eccc1627}{PV\_DL\_B\_AH\_MIN}})\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.gti\_weight\ =\ \mbox{\hyperlink{energy_8h_a821e3aa59b88068f6ee5d1b8a922bd43}{PV\_DL\_EXCESS}}\ +\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.dl\_excess\_adj;}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.gti\_weight\ =\ 0.0f;\ \textcolor{comment}{//\ reduce\ power\ to\ zero}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00161\ \ \ \ \ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bsoc_8c_a017e138f3c81b9dd94af5d7e7bd7616c}{dc0\_filter}}(\mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.gti\_weight);}
\DoxyCodeLine{00165\ \};}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=235pt]{bsoc_8c_ab9a97f08a9166d16e45b2025c3887eab_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c_ab9a97f08a9166d16e45b2025c3887eab_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a571a7c60ba1a2a6c569427c21c829733}\index{bsoc.c@{bsoc.c}!bsoc\_init@{bsoc\_init}}
\index{bsoc\_init@{bsoc\_init}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{bsoc\_init()}{bsoc\_init()}}
{\footnotesize\ttfamily \label{bsoc_8c_a571a7c60ba1a2a6c569427c21c829733} 
bool bsoc\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00061\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.ac\_weight\ =\ 0.0f;}
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.gti\_weight\ =\ 0.0f;}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{comment}{//\ use\ MUTEX\ locks\ for\ message\ passing\ between\ remote\ programs}}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordflow}{if}\ (pthread\_mutex\_init(\&\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.ha\_lock,\ NULL)\ !=\ 0)\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ fprintf(\mbox{\hyperlink{energy_8c_acec19516a59050bb447192fe318e6a9c}{fout}},\ \textcolor{stringliteral}{"{}\(\backslash\)n\%s\ mutex\ init\ has\ failed\(\backslash\)n"{}},\ \mbox{\hyperlink{energy_8c_a18b19ee666a9edc39d904a474ddee1d9}{log\_time}}(\textcolor{keyword}{false}));}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00068\ \ \ \ \ \}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00070\ \};}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c_a571a7c60ba1a2a6c569427c21c829733_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=217pt]{bsoc_8c_a571a7c60ba1a2a6c569427c21c829733_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a49c1e06b8059a63a9ed7c7d729e59d90}\index{bsoc.c@{bsoc.c}!bsoc\_set\_mode@{bsoc\_set\_mode}}
\index{bsoc\_set\_mode@{bsoc\_set\_mode}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{bsoc\_set\_mode()}{bsoc\_set\_mode()}}
{\footnotesize\ttfamily \label{bsoc_8c_a49c1e06b8059a63a9ed7c7d729e59d90} 
bool bsoc\+\_\+set\+\_\+mode (\begin{DoxyParamCaption}\item[{const double}]{target}{, }\item[{const bool}]{mode}{, }\item[{const bool}]{init}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00262\ \{}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ bsoc\_mode\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ bsoc\_high\ =\ \textcolor{keyword}{false},\ ha\_ac\_mode\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ accum\ =\ 0.0f,\ vpwa\ =\ 0.0f;}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{keywordflow}{if}\ (init)\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ bsoc\_mode\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ bsoc\_high\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ ha\_ac\_mode\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ accum\ =\ 0.0f;}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ vpwa\ =\ 0.0f;}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00274\ \ \ \ \ \}}
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00276\ \textcolor{comment}{\ \ \ \ \ *\ running\ avg\ filter}}
\DoxyCodeLine{00277\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00278\ \ \ \ \ accum\ =\ accum\ -\/\ accum\ /\ \mbox{\hyperlink{bsoc_8h_a7b9e7fc82e04c2af0cd3f9a6185754df}{COEFN}}\ +\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072ad5c883c864f682ae706402bbcbe385cf}{V\_PWA}}];}
\DoxyCodeLine{00279\ \ \ \ \ vpwa\ =\ accum\ /\ \mbox{\hyperlink{bsoc_8h_a7b9e7fc82e04c2af0cd3f9a6185754df}{COEFN}};}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordflow}{if}\ ((vpwa\ >=\ \mbox{\hyperlink{bsoc_8h_a9e1f90eeafcf3b25dba060a41c7de785}{PV\_FULL\_PWR}})\ \&\&\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a821ba4dacc502ba41ec0c17aff5c42d3}{V\_FBEKW}}]\ >=\ \mbox{\hyperlink{energy_8h_ad844217bc1ad213a7424c3edc9f3ccbd}{MIN\_BAT\_KW\_BSOC\_HI}}))\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!bsoc\_mode)\ \{}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pid_8c_a2845499736d4daabdc6bfcb637203535}{ResetPI}}(\&\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.pid);}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ bsoc\_mode\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ bsoc\_high\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ha\_ac\_mode)\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_a9a2e9166d49137eb9230625ac072807d}{ha\_ac\_on}}();}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ ha\_ac\_mode\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bsoc\_high)\ \{\ \textcolor{comment}{//\ turn\ off\ at\ min\ limit\ power}}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((vpwa\ >=\ \mbox{\hyperlink{bsoc_8h_a907125f6d59e3a4b66afc8f3734eaa1d}{PV\_MIN\_PWR}})\ \&\&\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a821ba4dacc502ba41ec0c17aff5c42d3}{V\_FBEKW}}]\ >=\ \mbox{\hyperlink{energy_8h_ad844217bc1ad213a7424c3edc9f3ccbd}{MIN\_BAT\_KW\_BSOC\_HI}}))\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bsoc\_mode\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ha\_ac\_mode)\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_a2c6c70b9a184aa76393a677b08954c81}{ha\_ac\_off}}();}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ha\_ac\_mode\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bsoc\_high\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ha\_ac\_mode\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00305\ \ \ \ \ \}}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.gti\_dumpload\ =\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.print\_vars[\mbox{\hyperlink{energy_8h_a5a73f316e17083fb4d7cbf348494322a}{L3\_P}}]*\ -\/1.0f)\ +\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a78658cf8e5d2393c6d0148b279287efc}{V\_DPPV}}];\ \textcolor{comment}{//\ use\ as\ a\ temp\ variable}}
\DoxyCodeLine{00308\ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.total\_system\ =\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a1e904f1377abb70e57726e114ff22765}{V\_FLO}}]\ -\/\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.gti\_dumpload)\ +\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a78658cf8e5d2393c6d0148b279287efc}{V\_DPPV}}]\ +(\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.print\_vars[\mbox{\hyperlink{energy_8h_a5a73f316e17083fb4d7cbf348494322a}{L3\_P}}]*\ -\/1.0f);}
\DoxyCodeLine{00309\ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.gti\_dumpload\ =\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.print\_vars[\mbox{\hyperlink{energy_8h_a5a73f316e17083fb4d7cbf348494322a}{L3\_P}}]*\ -\/1.0f)\ -\/\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a78658cf8e5d2393c6d0148b279287efc}{V\_DPPV}}];\ \textcolor{comment}{//\ use\ this\ value}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00312\ \textcolor{comment}{\ \ \ \ \ *\ look\ at\ system\ energy\ balance\ for\ power\ control\ drive}}
\DoxyCodeLine{00313\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{if}\ (mode)\ \{\ \textcolor{comment}{//\ add\ GTI\ power\ from\ dumpload}}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.error\ =\ (int32\_t)\ \mbox{\hyperlink{pid_8c_a87884a0dc8b50e94a38729d4a911e780}{UpdatePI}}(\&\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.pid,\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a47acb84856d0db6447de2c99171d654d}{V\_BEN}}]\ +\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.gti\_dumpload\ +\ \mbox{\hyperlink{bsoc_8h_a27e0b9791217cb777e9f790b9b5b7a1d}{PBAL\_OFFSET}});}
\DoxyCodeLine{00316\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.error\ =\ (int32\_t)\ \mbox{\hyperlink{pid_8c_a87884a0dc8b50e94a38729d4a911e780}{UpdatePI}}(\&\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.pid,\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a47acb84856d0db6447de2c99171d654d}{V\_BEN}}]\ +\ \mbox{\hyperlink{bsoc_8h_a27e0b9791217cb777e9f790b9b5b7a1d}{PBAL\_OFFSET}});}
\DoxyCodeLine{00318\ \ \ \ \ \}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.error\ >\ 0.0f)\ \{}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.coef\ =\ \mbox{\hyperlink{bsoc_8h_aadf817f59fb13a1a5c66ea9f7574b842}{COEF}};}
\DoxyCodeLine{00322\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.coef\ =\ \mbox{\hyperlink{bsoc_8h_a7b9e7fc82e04c2af0cd3f9a6185754df}{COEFN}};}
\DoxyCodeLine{00324\ \ \ \ \ \}}
\DoxyCodeLine{00325\ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.target\ =\ target;}
\DoxyCodeLine{00326\ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.error\ =\ round(\mbox{\hyperlink{bsoc_8c_aa9b00e4f08c59d45a2baa05cc44191a2}{error\_filter}}(\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.error));}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00328\ \textcolor{comment}{\ \ \ \ \ *\ check\ for\ idle\ flag\ from\ HA}}
\DoxyCodeLine{00329\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.con6)\ \{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ ha\_ac\_mode\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ bsoc\_mode\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00333\ \ \ \ \ \}}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00336\ \textcolor{comment}{\ \ \ \ \ *\ HA\ start\ excess\ button\ pressed}}
\DoxyCodeLine{00337\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00338\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.con4)\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.dl\_excess\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.con4\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00341\ \ \ \ \ \}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00344\ \textcolor{comment}{\ \ \ \ \ *\ HA\ stop\ excess\ button\ pressed}}
\DoxyCodeLine{00345\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.con5)\ \{}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mqtt__vars_8c_a3fc1eb9cd6b570d96277f671de9e979a}{mqtt\_gti\_power}}(\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.client\_p,\ \mbox{\hyperlink{energy_8h_a8170bc07eb3b7f53bb8bfea780ebfdd8}{TOPIC\_P}},\ \textcolor{stringliteral}{"{}Z\#"{}},\ 9);\ \textcolor{comment}{//\ zero\ power\ at\ excess\ shutdown}}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.dl\_excess\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.con5\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00350\ \ \ \ \ \}}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00353\ \textcolor{comment}{\ \ \ \ \ *\ DL\ buffer\ battery\ low\ set-\/point\ excess\ load\ shutdown}}
\DoxyCodeLine{00354\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00355\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a79eef89bbb62af24bc79c04f29d0ad97}{V\_DAHBAT}}]\ <\ \mbox{\hyperlink{energy_8h_aa475e97af32e6972baba4dd1a61f48df}{PV\_DL\_B\_AH\_LOW}})\ \{}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mqtt__vars_8c_a3fc1eb9cd6b570d96277f671de9e979a}{mqtt\_gti\_power}}(\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.client\_p,\ \mbox{\hyperlink{energy_8h_a8170bc07eb3b7f53bb8bfea780ebfdd8}{TOPIC\_P}},\ \textcolor{stringliteral}{"{}Z\#"{}},\ 10);\ \textcolor{comment}{//\ zero\ power\ at\ excess\ shutdown}}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.dl\_excess\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.con4\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mode.con5\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00360\ \ \ \ \ \}}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{keywordflow}{return}\ bsoc\_mode;}
\DoxyCodeLine{00363\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c_a49c1e06b8059a63a9ed7c7d729e59d90_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=249pt]{bsoc_8c_a49c1e06b8059a63a9ed7c7d729e59d90_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_adc8522b4d922a9ce45f83ca6a8d2708c}\index{bsoc.c@{bsoc.c}!bsoc\_set\_std\_dev@{bsoc\_set\_std\_dev}}
\index{bsoc\_set\_std\_dev@{bsoc\_set\_std\_dev}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{bsoc\_set\_std\_dev()}{bsoc\_set\_std\_dev()}}
{\footnotesize\ttfamily \label{bsoc_8c_adc8522b4d922a9ce45f83ca6a8d2708c} 
void bsoc\+\_\+set\+\_\+std\+\_\+dev (\begin{DoxyParamCaption}\item[{const double}]{value}{, }\item[{const uint32\+\_\+t}]{i}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00076\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.bat\_c\_std\_dev[i]\ =\ value;}
\DoxyCodeLine{00078\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c_adc8522b4d922a9ce45f83ca6a8d2708c_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a822d408a5e379216cd6a003381f94b43}\index{bsoc.c@{bsoc.c}!calculateStandardDeviation@{calculateStandardDeviation}}
\index{calculateStandardDeviation@{calculateStandardDeviation}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{calculateStandardDeviation()}{calculateStandardDeviation()}}
{\footnotesize\ttfamily \label{bsoc_8c_a822d408a5e379216cd6a003381f94b43} 
double calculate\+Standard\+Deviation (\begin{DoxyParamCaption}\item[{const uint32\+\_\+t}]{N}{, }\item[{const double}]{data}{\mbox{[}$\,$\mbox{]}}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00205\ \{}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{comment}{//\ variable\ to\ store\ sum\ of\ the\ given\ data}}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keywordtype}{double}\ sum\ =\ 0;}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ N;\ i++)\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ sum\ +=\ data[i];}
\DoxyCodeLine{00211\ \ \ \ \ \}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{comment}{//\ calculating\ mean}}
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordtype}{double}\ mean\ =\ sum\ /\ N;}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{comment}{//\ temporary\ variable\ to\ store\ the\ summation\ of\ square}}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{comment}{//\ of\ difference\ between\ individual\ data\ items\ and\ mean}}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordtype}{double}\ values\ =\ 0;}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ N;\ i++)\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ values\ +=\ pow(data[i]\ -\/\ mean,\ 2);}
\DoxyCodeLine{00222\ \ \ \ \ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{comment}{//\ variance\ is\ the\ square\ of\ standard\ deviation}}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordtype}{double}\ variance\ =\ values\ /\ N;}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{comment}{//\ calculating\ standard\ deviation\ by\ finding\ square\ root}}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{comment}{//\ of\ variance}}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keywordtype}{double}\ standardDeviation\ =\ sqrt(variance);}
\DoxyCodeLine{00230\ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.batc\_std\_dev\ =\ standardDeviation;}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \textcolor{preprocessor}{\#ifdef\ BSOC\_DEBUG}}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{comment}{//\ printing\ standard\ deviation}}
\DoxyCodeLine{00234\ \ \ \ \ fprintf(\mbox{\hyperlink{energy_8c_acec19516a59050bb447192fe318e6a9c}{fout}},\ \textcolor{stringliteral}{"{}STD\ DEV\ of\ Current\ \%.2f\(\backslash\)r\(\backslash\)n"{}},\ standardDeviation);}
\DoxyCodeLine{00235\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordflow}{return}\ standardDeviation;}
\DoxyCodeLine{00237\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c_a822d408a5e379216cd6a003381f94b43_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a017e138f3c81b9dd94af5d7e7bd7616c}\index{bsoc.c@{bsoc.c}!dc0\_filter@{dc0\_filter}}
\index{dc0\_filter@{dc0\_filter}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{dc0\_filter()}{dc0\_filter()}}
{\footnotesize\ttfamily \label{bsoc_8c_a017e138f3c81b9dd94af5d7e7bd7616c} 
double dc0\+\_\+filter (\begin{DoxyParamCaption}\item[{const double}]{raw}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00400\ \{}
\DoxyCodeLine{00401\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ accum\ =\ 0.0f;}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ coef\ =\ \mbox{\hyperlink{bsoc_8h_aeeb125aaf18ebb1dfcd400ac4c9cfb75}{COEFF}};}
\DoxyCodeLine{00403\ \ \ \ \ accum\ =\ accum\ -\/\ accum\ /\ coef\ +\ raw;}
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keywordflow}{return}\ accum\ /\ coef;}
\DoxyCodeLine{00405\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c_a017e138f3c81b9dd94af5d7e7bd7616c_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a623a5ccd411eeeba8acd1132a33a15e8}\index{bsoc.c@{bsoc.c}!dc1\_filter@{dc1\_filter}}
\index{dc1\_filter@{dc1\_filter}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{dc1\_filter()}{dc1\_filter()}}
{\footnotesize\ttfamily \label{bsoc_8c_a623a5ccd411eeeba8acd1132a33a15e8} 
double dc1\+\_\+filter (\begin{DoxyParamCaption}\item[{const double}]{raw}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00408\ \{}
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ accum\ =\ 0.0f;}
\DoxyCodeLine{00410\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ coef\ =\ \mbox{\hyperlink{bsoc_8h_aadf817f59fb13a1a5c66ea9f7574b842}{COEF}};}
\DoxyCodeLine{00411\ \ \ \ \ accum\ =\ accum\ -\/\ accum\ /\ coef\ +\ raw;}
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{keywordflow}{return}\ accum\ /\ coef;}
\DoxyCodeLine{00413\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=219pt]{bsoc_8c_a623a5ccd411eeeba8acd1132a33a15e8_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a4846561257bfbb8d753328d1fe7a1c07}\index{bsoc.c@{bsoc.c}!dc2\_filter@{dc2\_filter}}
\index{dc2\_filter@{dc2\_filter}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{dc2\_filter()}{dc2\_filter()}}
{\footnotesize\ttfamily \label{bsoc_8c_a4846561257bfbb8d753328d1fe7a1c07} 
double dc2\+\_\+filter (\begin{DoxyParamCaption}\item[{const double}]{raw}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00416\ \{}
\DoxyCodeLine{00417\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ accum\ =\ 0.0f;}
\DoxyCodeLine{00418\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ coef\ =\ \mbox{\hyperlink{bsoc_8h_aadf817f59fb13a1a5c66ea9f7574b842}{COEF}};}
\DoxyCodeLine{00419\ \ \ \ \ accum\ =\ accum\ -\/\ accum\ /\ coef\ +\ raw;}
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{keywordflow}{return}\ accum\ /\ coef;}
\DoxyCodeLine{00421\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=219pt]{bsoc_8c_a4846561257bfbb8d753328d1fe7a1c07_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a9ceac393328d0a6c09cccc8c38fa30a1}\index{bsoc.c@{bsoc.c}!drive0\_filter@{drive0\_filter}}
\index{drive0\_filter@{drive0\_filter}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{drive0\_filter()}{drive0\_filter()}}
{\footnotesize\ttfamily \label{bsoc_8c_a9ceac393328d0a6c09cccc8c38fa30a1} 
double drive0\+\_\+filter (\begin{DoxyParamCaption}\item[{const double}]{raw}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00424\ \{}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ accum\ =\ 0.0f;}
\DoxyCodeLine{00426\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ coef\ =\ \mbox{\hyperlink{bsoc_8h_aadf817f59fb13a1a5c66ea9f7574b842}{COEF}};}
\DoxyCodeLine{00427\ \ \ \ \ accum\ =\ accum\ -\/\ accum\ /\ coef\ +\ raw;}
\DoxyCodeLine{00428\ \ \ \ \ \textcolor{keywordflow}{return}\ accum\ /\ coef;}
\DoxyCodeLine{00429\ \}}

\end{DoxyCode}
\Hypertarget{bsoc_8c_a9cf492c9b858a53133af1b29b9f68708}\index{bsoc.c@{bsoc.c}!drive1\_filter@{drive1\_filter}}
\index{drive1\_filter@{drive1\_filter}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{drive1\_filter()}{drive1\_filter()}}
{\footnotesize\ttfamily \label{bsoc_8c_a9cf492c9b858a53133af1b29b9f68708} 
double drive1\+\_\+filter (\begin{DoxyParamCaption}\item[{const double}]{raw}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00432\ \{}
\DoxyCodeLine{00433\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ accum\ =\ 0.0f;}
\DoxyCodeLine{00434\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ coef\ =\ \mbox{\hyperlink{bsoc_8h_aeeb125aaf18ebb1dfcd400ac4c9cfb75}{COEFF}};}
\DoxyCodeLine{00435\ \ \ \ \ accum\ =\ accum\ -\/\ accum\ /\ coef\ +\ raw;}
\DoxyCodeLine{00436\ \ \ \ \ \textcolor{keywordflow}{return}\ accum\ /\ coef;}
\DoxyCodeLine{00437\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=346pt]{bsoc_8c_a9cf492c9b858a53133af1b29b9f68708_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_aa9b00e4f08c59d45a2baa05cc44191a2}\index{bsoc.c@{bsoc.c}!error\_filter@{error\_filter}}
\index{error\_filter@{error\_filter}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{error\_filter()}{error\_filter()}}
{\footnotesize\ttfamily \label{bsoc_8c_aa9b00e4f08c59d45a2baa05cc44191a2} 
double error\+\_\+filter (\begin{DoxyParamCaption}\item[{const double}]{raw}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00369\ \{}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ accum\ =\ 0.0f;}
\DoxyCodeLine{00371\ \ \ \ \ accum\ =\ accum\ -\/\ accum\ /\ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.coef\ +\ raw;}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{keywordflow}{return}\ accum\ /\ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.coef;}
\DoxyCodeLine{00373\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c_aa9b00e4f08c59d45a2baa05cc44191a2_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_a8f6e0fd4594d467a89005d81038aa602}\index{bsoc.c@{bsoc.c}!get\_batc\_dev@{get\_batc\_dev}}
\index{get\_batc\_dev@{get\_batc\_dev}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{get\_batc\_dev()}{get\_batc\_dev()}}
{\footnotesize\ttfamily \label{bsoc_8c_a8f6e0fd4594d467a89005d81038aa602} 
double get\+\_\+batc\+\_\+dev (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00196\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.batc\_std\_dev;}
\DoxyCodeLine{00198\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bsoc_8c_a8f6e0fd4594d467a89005d81038aa602_icgraph}
\end{center}
\end{figure}
\Hypertarget{bsoc_8c_ade03000a21b56a5527367c81e7219c99}\index{bsoc.c@{bsoc.c}!gti\_test@{gti\_test}}
\index{gti\_test@{gti\_test}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{gti\_test()}{gti\_test()}}
{\footnotesize\ttfamily \label{bsoc_8c_ade03000a21b56a5527367c81e7219c99} 
double gti\+\_\+test (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00171\ \{}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{//\ check\ for\ 48VDC\ AC\ charger\ powered\ from\ the\ Solar\ battery\ bank\ AC\ inverter}}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordflow}{if}\ (((\mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.pv\_voltage\ <\ \mbox{\hyperlink{bsoc_8h_ac72ac391d051ffd4e1d466d6ede48b34}{MIN\_PV\_VOLTS}})\ \&\&\ (!\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.dl\_excess))\ ||\ (\mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.bat\_voltage\ <\ \mbox{\hyperlink{bsoc_8h_ade1038e9edec3b8646f4288f3b32b713}{MIN\_BAT\_VOLTS}}))\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.gti\_weight\ =\ 0.0f;\ \textcolor{comment}{//\ reduce\ power\ to\ zero}}
\DoxyCodeLine{00175\ \textcolor{preprocessor}{\#ifdef\ BSOC\_DEBUG}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ fprintf(\mbox{\hyperlink{energy_8c_acec19516a59050bb447192fe318e6a9c}{fout}},\ \textcolor{stringliteral}{"{}pvp\ \%8.2f,\ gweight\ \%8.2f,\ aweight\ \%8.2f,\ batv\ \%8.2f,\ batc\ \%8.2f\(\backslash\)r\(\backslash\)n"{}},\ pv\_voltage,\ gti\_weight,\ ac\_weight,\ bat\_voltage,\ bat\_current);}
\DoxyCodeLine{00177\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00178\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.dl\_excess)\ \{}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.mvar[\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072a79eef89bbb62af24bc79c04f29d0ad97}{V\_DAHBAT}}]\ >\ \mbox{\hyperlink{energy_8h_a69ba8a83d257f96478010c24eccc1627}{PV\_DL\_B\_AH\_MIN}})\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.gti\_weight\ =\ \mbox{\hyperlink{energy_8h_a821e3aa59b88068f6ee5d1b8a922bd43}{PV\_DL\_EXCESS}}\ +\ \mbox{\hyperlink{energy_8c_aae3805c63e28abac1e41ffd7b623596e}{E}}.dl\_excess\_adj;}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.gti\_weight\ =\ 0.0f;\ \textcolor{comment}{//\ reduce\ power\ to\ zero}}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00186\ \ \ \ \ \}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bsoc_8c_a017e138f3c81b9dd94af5d7e7bd7616c}{dc0\_filter}}(\mbox{\hyperlink{bsoc_8c_abde809820d909d15f6f2b063208258ef}{L}}.gti\_weight);}
\DoxyCodeLine{00188\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=231pt]{bsoc_8c_ade03000a21b56a5527367c81e7219c99_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=210pt]{bsoc_8c_ade03000a21b56a5527367c81e7219c99_icgraph}
\end{center}
\end{figure}


\doxysubsection{Variable Documentation}
\Hypertarget{bsoc_8c_abde809820d909d15f6f2b063208258ef}\index{bsoc.c@{bsoc.c}!L@{L}}
\index{L@{L}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{L}{L}}
{\footnotesize\ttfamily \label{bsoc_8c_abde809820d909d15f6f2b063208258ef} 
struct \mbox{\hyperlink{structlocal__type}{local\+\_\+type}} L\hspace{0.3cm}{\ttfamily [static]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{=\ \{}
\DoxyCodeLine{\ \ \ \ .ac\_weight\ =\ 0.0f,}
\DoxyCodeLine{\ \ \ \ .bat\_current\ =\ 0.0f,}
\DoxyCodeLine{\ \ \ \ .bat\_voltage\ =\ 0.0f,}
\DoxyCodeLine{\ \ \ \ .batc\_std\_dev\ =\ 0.0f,}
\DoxyCodeLine{\ \ \ \ .coef\ =\ \mbox{\hyperlink{bsoc_8h_aadf817f59fb13a1a5c66ea9f7574b842}{COEF}},}
\DoxyCodeLine{\ \ \ \ .gti\_weight\ =\ 0.0f,}
\DoxyCodeLine{\ \ \ \ .pv\_voltage\ =\ 0.0f,}
\DoxyCodeLine{\}}

\end{DoxyCode}

\begin{DoxyCode}{0}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00046\ \ \ \ \ .ac\_weight\ =\ 0.0f,}
\DoxyCodeLine{00047\ \ \ \ \ .bat\_current\ =\ 0.0f,}
\DoxyCodeLine{00048\ \ \ \ \ .bat\_voltage\ =\ 0.0f,}
\DoxyCodeLine{00049\ \ \ \ \ .batc\_std\_dev\ =\ 0.0f,}
\DoxyCodeLine{00050\ \ \ \ \ .coef\ =\ \mbox{\hyperlink{bsoc_8h_aadf817f59fb13a1a5c66ea9f7574b842}{COEF}},}
\DoxyCodeLine{00051\ \ \ \ \ .gti\_weight\ =\ 0.0f,}
\DoxyCodeLine{00052\ \ \ \ \ .pv\_voltage\ =\ 0.0f,}
\DoxyCodeLine{00053\ \};}

\end{DoxyCode}
\Hypertarget{bsoc_8c_ae6b57480d8cda466cfc65b9bfc47b255}\index{bsoc.c@{bsoc.c}!mqtt\_name@{mqtt\_name}}
\index{mqtt\_name@{mqtt\_name}!bsoc.c@{bsoc.c}}
\doxysubsubsection{\texorpdfstring{mqtt\_name}{mqtt\_name}}
{\footnotesize\ttfamily \label{bsoc_8c_ae6b57480d8cda466cfc65b9bfc47b255} 
const char\texorpdfstring{$\ast$}{*} mqtt\+\_\+name\mbox{[}\mbox{\hyperlink{energy_8h_a4798b70da5e09a128bfc682db0b65072ab183b38bd716ecf9405c4546e3bd6870}{V\+\_\+\+DLAST}}\mbox{]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00003\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00004\ \ \ \ \ \textcolor{stringliteral}{"{}pccmode"{}},}
\DoxyCodeLine{00005\ \ \ \ \ \textcolor{stringliteral}{"{}batenergykw"{}},}
\DoxyCodeLine{00006\ \ \ \ \ \textcolor{stringliteral}{"{}runtime"{}},}
\DoxyCodeLine{00007\ \ \ \ \ \textcolor{stringliteral}{"{}bamps"{}},}
\DoxyCodeLine{00008\ \ \ \ \ \textcolor{stringliteral}{"{}bvolts"{}},}
\DoxyCodeLine{00009\ \ \ \ \ \textcolor{stringliteral}{"{}load"{}},}
\DoxyCodeLine{00010\ \ \ \ \ \textcolor{stringliteral}{"{}solar"{}},}
\DoxyCodeLine{00011\ \ \ \ \ \textcolor{stringliteral}{"{}acenergy"{}},}
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{stringliteral}{"{}benergy"{}},}
\DoxyCodeLine{00013\ \ \ \ \ \textcolor{stringliteral}{"{}pwatts"{}},}
\DoxyCodeLine{00014\ \ \ \ \ \textcolor{stringliteral}{"{}pamps"{}},}
\DoxyCodeLine{00015\ \ \ \ \ \textcolor{stringliteral}{"{}pvolts"{}},}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{stringliteral}{"{}flast"{}},}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{stringliteral}{"{}HAdcsw"{}},}
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{stringliteral}{"{}HAacsw"{}},}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{stringliteral}{"{}HAshut"{}},}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{stringliteral}{"{}HAmode"{}},}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{stringliteral}{"{}HAcon0"{}},}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{stringliteral}{"{}HAcon1"{}},}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{stringliteral}{"{}HAcon2"{}},}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{stringliteral}{"{}HAcon3"{}},}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{stringliteral}{"{}HAcon4"{}},}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{stringliteral}{"{}HAcon5"{}},}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{stringliteral}{"{}HAcon6"{}},}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{stringliteral}{"{}HAcon7"{}},}
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{stringliteral}{"{}DLv\_pv"{}},}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{stringliteral}{"{}DLp\_pv"{}},}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{stringliteral}{"{}DLp\_bat"{}},}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{stringliteral}{"{}DLv\_bat"{}},}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{stringliteral}{"{}DLc\_mppt"{}},}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{stringliteral}{"{}DLp\_mppt"{}},}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{stringliteral}{"{}DLah\_bat"{}},}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{stringliteral}{"{}DLccmode"{}},}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{stringliteral}{"{}DLgti"{}},}
\DoxyCodeLine{00038\ \};}

\end{DoxyCode}
